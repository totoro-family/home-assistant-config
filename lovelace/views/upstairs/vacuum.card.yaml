type: vertical-stack
cards:
  - type: entities
    entities:
      - vacuum.fungus
  - type: custom:xiaomi-vacuum-map-card
    map_source:
      camera: camera.fungus_map
    calibration_source:
      camera: true
    entity: vacuum.fungus
    vacuum_platform: send_command
    title: Fungus
    map_locked: false
    map_modes:
      - name: Zone cleanup
        icon: mdi:select-drag
        run_immediately: false
        coordinates_rounding: true
        selection_type: MANUAL_RECTANGLE
        max_selections: 5
        repeats_type: EXTERNAL
        max_repeats: 3
        service_call_schema:
          service: roborock.vacuum_clean_zone
          service_data:
            zone: '[[selection]]'
            repeats: '[[repeats]]'
            entity_id: '[[entity_id]]'
        predefined_selections: []
        variables: {}
      - name: Pin & Go
        icon: mdi:map-marker-plus
        run_immediately: false
        coordinates_rounding: true
        selection_type: MANUAL_POINT
        max_selections: 999
        repeats_type: NONE
        max_repeats: 1
        service_call_schema:
          service: roborock.vacuum_goto
          service_data:
            x_coord: '[[point_x]]'
            y_coord: '[[point_y]]'
            entity_id: '[[entity_id]]'
        predefined_selections: []
        variables: {}
      - name: Rooms
        icon: mdi:floor-plan
        run_immediately: false
        coordinates_rounding: true
        selection_type: ROOM
        max_selections: 999
        repeats_type: REPEAT
        max_repeats: 3
        service_call_schema:
          service: roborock.vacuum_clean_segment
          service_data:
            segments: '[[selection]]'
            entity_id: '[[entity_id]]'
        predefined_selections:
          - id: 16
            icon:
              name: mdi:broom
              x: 25975
              'y': 26675
            label:
              text: Bathroom
              x: 25975
              'y': 26675
              offset_y: 35
            outline:
              - - 24150
                - 25350
              - - 27800
                - 25350
              - - 27800
                - 28000
              - - 24150
                - 28000
          - id: 17
            icon:
              name: mdi:broom
              x: 25150
              'y': 29775
            label:
              text: Bedroom
              x: 25150
              'y': 29775
              offset_y: 35
            outline:
              - - 22650
                - 26750
              - - 27650
                - 26750
              - - 27650
                - 32800
              - - 22650
                - 32800
          - id: 18
            icon:
              name: mdi:broom
              x: 20325
              'y': 29175
            label:
              text: Guestroom
              x: 20325
              'y': 29175
              offset_y: 35
            outline:
              - - 17750
                - 27500
              - - 22900
                - 27500
              - - 22900
                - 30850
              - - 17750
                - 30850
          - id: 19
            icon:
              name: mdi:broom
              x: 20950
              'y': 26600
            label:
              text: Gallery
              x: 20950
              'y': 26600
              offset_y: 35
            outline:
              - - 17750
                - 25300
              - - 24150
                - 25300
              - - 24150
                - 27900
              - - 17750
                - 27900
        variables: {}
    tiles:
      - tile_id: battery_level
        entity: vacuum.fungus
        label: Battery
        attribute: battery_level
        icon: mdi:battery-charging-100
        unit: "%"
      - tile_id: fan_speed
        entity: vacuum.fungus
        label: Fan speed
        attribute: fan_speed
        icon: mdi:fan
        translations:
          'off': 'Off'
          silent: Silent
          balanced: Balanced
          turbo: Turbo
          max: Max
          max_plus: Max+
          custom: Custom
      - entity: vacuum.fungus
        label: Mop intensity
        attribute: mop_intensity
        icon: mdi:water-opacity
        translations:
          'off': 'Off'
          mild: Mild
          moderate: Moderate
          intense: Intense
          custom: Custom
        conditions:
          # workaround for https://github.com/humbertogontijo/homeassistant-roborock/issues/179
          # - entity: binary_sensor.fungus_mop_attached
          - entity: vacuum.fungus
            attribute: water_box_carriage_status
            value: 1
      - entity: vacuum.fungus
        label: Mop route
        attribute: mop_mode
        icon: mdi:water-sync
        translations:
          standard: Standard
          deep: Deep
          deep_plus: Deep+
          custom: Custom
        conditions:
          # workaround for https://github.com/humbertogontijo/homeassistant-roborock/issues/179
          # - entity: binary_sensor.fungus_mop_attached
          - entity: vacuum.fungus
            attribute: water_box_carriage_status
            value: 1
          - entity: vacuum.fungus
            attribute: mop_intensity
            value_not: 'off'
      - entity: sensor.fungus_current_error
        label: Current error
        icon: mdi:alert
        conditions:
          - entity: sensor.fungus_current_error
            value_not: None
      # workaround for https://github.com/humbertogontijo/homeassistant-roborock/issues/179
      # - entity: binary_sensor.fungus_mop_attached
      #   label: Mop attached
      #   icon: mdi:receipt-outline
      #   translations:
      #     'on': 'Yes'
      #     'off': 'No'
      - entity: vacuum.fungus
        attribute: water_box_carriage_status
        label: Mop attached
        icon: mdi:receipt-outline
        translations:
          1: 'Yes'
          0: 'No'
      - entity: sensor.fungus_filter_left
        label: Filter left
        icon: mdi:air-filter
        unit: " h"
        multiplier: 0.00027777777 # 1/3600
        precision: 0
      - entity: sensor.fungus_main_brush_left
        label: Main brush left
        icon: mdi:brush
        unit: " h"
        multiplier: 0.00027777777 # 1/3600
        precision: 0
      - entity: sensor.fungus_sensor_dirty_left
        label: Sensor dirty left
        icon: mdi:eye-outline
        unit: " h"
        multiplier: 0.00027777777 # 1/3600
        precision: 0
      - entity: sensor.fungus_side_brush_left
        label: Side brush left
        icon: mdi:brush
        unit: " h"
        multiplier: 0.00027777777 # 1/3600
        precision: 0
      - entity: sensor.fungus_total_clean_count
        label: Total clean count
        icon: mdi:counter
    icons:
      - icon: mdi:play
        conditions:
          - entity: vacuum.fungus
            value_not: cleaning
          - entity: vacuum.fungus
            value_not: error
          - entity: vacuum.fungus
            value_not: returning
        tooltip: Start
        tap_action:
          action: call-service
          service: vacuum.start
          service_data:
            entity_id: vacuum.fungus
      - icon: mdi:pause
        conditions:
          - entity: vacuum.fungus
            value_not: docked
          - entity: vacuum.fungus
            value_not: idle
          - entity: vacuum.fungus
            value_not: error
          - entity: vacuum.fungus
            value_not: paused
        tooltip: Pause
        tap_action:
          action: call-service
          service: vacuum.pause
          service_data:
            entity_id: vacuum.fungus
      - icon: mdi:stop
        conditions:
          - entity: vacuum.fungus
            value_not: docked
          - entity: vacuum.fungus
            value_not: idle
          - entity: vacuum.fungus
            value_not: error
          - entity: vacuum.fungus
            value_not: paused
        tooltip: Stop
        tap_action:
          action: call-service
          service: vacuum.stop
          service_data:
            entity_id: vacuum.fungus
      - icon: mdi:home-map-marker
        conditions:
          - entity: vacuum.fungus
            value_not: docked
          - entity: vacuum.fungus
            value_not: returning
        tooltip: Return to base
        tap_action:
          action: call-service
          service: vacuum.return_to_base
          service_data:
            entity_id: vacuum.fungus
      - icon: mdi:target-variant
        conditions:
          - entity: vacuum.fungus
            value_not: docked
          - entity: vacuum.fungus
            value_not: error
          - entity: vacuum.fungus
            value_not: cleaning
          - entity: vacuum.fungus
            value_not: returning
        tooltip: Clean spot
        tap_action:
          action: call-service
          service: vacuum.clean_spot
          service_data:
            entity_id: vacuum.fungus
      - icon: mdi:bullhorn
        tooltip: Locate
        tap_action:
          action: call-service
          service: vacuum.locate
          service_data:
            entity_id: vacuum.fungus
      - icon: mdi:fan
        conditions:
          - entity: vacuum.fungus
            attribute: fan_speed
            value: "off"
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: vacuum.set_fan_speed
          service_data:
            entity_id: vacuum.fungus
            fan_speed: silent
      - icon: mdi:fan
        conditions:
          - entity: vacuum.fungus
            attribute: fan_speed
            value: silent
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: vacuum.set_fan_speed
          service_data:
            entity_id: vacuum.fungus
            fan_speed: balanced
      - icon: mdi:fan
        conditions:
          - entity: vacuum.fungus
            attribute: fan_speed
            value: balanced
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: vacuum.set_fan_speed
          service_data:
            entity_id: vacuum.fungus
            fan_speed: turbo
      - icon: mdi:fan
        conditions:
          - entity: vacuum.fungus
            attribute: fan_speed
            value: turbo
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: vacuum.set_fan_speed
          service_data:
            entity_id: vacuum.fungus
            fan_speed: max
      - icon: mdi:fan
        conditions:
          - entity: vacuum.fungus
            attribute: fan_speed
            value: max
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: vacuum.set_fan_speed
          service_data:
            entity_id: vacuum.fungus
            fan_speed: max_plus
      - icon: mdi:fan
        conditions:
          - entity: vacuum.fungus
            attribute: fan_speed
            value: max_plus
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: vacuum.set_fan_speed
          service_data:
            entity_id: vacuum.fungus
            fan_speed: "off"
      - icon: mdi:fan
        conditions:
          - entity: vacuum.fungus
            attribute: fan_speed
            value_not: "off"
          - entity: vacuum.fungus
            attribute: fan_speed
            value_not: silent
          - entity: vacuum.fungus
            attribute: fan_speed
            value_not: balanced
          - entity: vacuum.fungus
            attribute: fan_speed
            value_not: turbo
          - entity: vacuum.fungus
            attribute: fan_speed
            value_not: max
          - entity: vacuum.fungus
            attribute: fan_speed
            value_not: max_plus
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: vacuum.set_fan_speed
          service_data:
            entity_id: vacuum.fungus
            fan_speed: "off"
      - icon: mdi:water-opacity
        conditions:
          - entity: vacuum.fungus
            attribute: mop_intensity
            value: "off"
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: roborock.vacuum_set_mop_intensity
          service_data:
            entity_id: vacuum.fungus
            mop_intensity: mild
      - icon: mdi:water-opacity
        conditions:
          - entity: vacuum.fungus
            attribute: mop_intensity
            value: mild
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: roborock.vacuum_set_mop_intensity
          service_data:
            entity_id: vacuum.fungus
            mop_intensity: moderate
      - icon: mdi:water-opacity
        conditions:
          - entity: vacuum.fungus
            attribute: mop_intensity
            value: moderate
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: roborock.vacuum_set_mop_intensity
          service_data:
            entity_id: vacuum.fungus
            mop_intensity: intense
      - icon: mdi:water-opacity
        conditions:
          - entity: vacuum.fungus
            attribute: mop_intensity
            value: intense
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: roborock.vacuum_set_mop_intensity
          service_data:
            entity_id: vacuum.fungus
            mop_intensity: "off"
      - icon: mdi:water-opacity
        conditions:
          - entity: vacuum.fungus
            attribute: mop_intensity
            value_not: "off"
          - entity: vacuum.fungus
            attribute: mop_intensity
            value_not: mild
          - entity: vacuum.fungus
            attribute: mop_intensity
            value_not: moderate
          - entity: vacuum.fungus
            attribute: mop_intensity
            value_not: intense
        tooltip: Change fan speed
        tap_action:
          action: call-service
          service: roborock.vacuum_set_mop_intensity
          service_data:
            entity_id: vacuum.fungus
            mop_intensity: "off"
