- id: prusheen_print_finished
  alias: "[Prusheen] Print finished"
  variables:
    snapshot_create_file_path: "/config/www/tmp/snapshot_prusheen_platecam.jpg"
    snapshot_access_file_path: "{{ snapshot_create_file_path | replace('/config/www','/local') }}"
  trigger:
    - platform: state
      from: "on"
      to: "off"
      entity_id: binary_sensor.prusheen_printing
  condition:
    condition: state
    entity_id: sensor.prusheen_job_percentage
    state: "100.0"
  action:
    - service: camera.snapshot
      entity_id: camera.prusheen_platecam_hd_stream
      data:
        filename: "{{ snapshot_create_file_path }}"
    - service: notify.notify
      data:
        message: "clear_notification"
        data:
          tag: "prusheen_print_failed"
    - service: notify.notify
      data:
        title: "Prusheen print finished"
        message: "Prusheen print finished at {{ now().strftime('%H:%M') }}"
        data:
          url: "/lovelace/prusheen"
          image: "{{ snapshot_access_file_path }}"
          tag: prusheen_print_finished
